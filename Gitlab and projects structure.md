# Проекты

Чтобы не путаться в своих собственных проектах, полезно соблюдать определенную структуру папок.
Она может быть, например, такой:
```
projects
	danIT
		homework
			homework1
			homework2
			homework3
			...
		classwork
			css-example-project
			html-example-project-2
			...
		fem7
```
избегайте русских символов и пробелов в именах папок и файлов, используйте - или  _ вместо пробелов.

> Плагин Project manager для VS Code позволяет делать закладки и быстро перемещаться между вашими проектами.

# Gitlab

Если вы зашли на Gitab, а у вас вверху висит выделенное желтым предупреждение, что вы должны создать пароль, иначе не сможете клонировать репозитории (такое возможно, если регистрировались с помощью gmail, например) - пройдите по ссылке и создайте пароль, иначе вы не сможете склонировать репозиторий.

Второе предупреждение может касаться отсутствия SSH-ключей, об этом можете не беспокоиться, SSH использовать не обязательно. прост закройте его.

## Клонирование репозитория

Попробуйте склонировать себе на компьютер репозиторий вашей группы.
Это позволит работать с его содержимым, даже не имея доступа к интернету.

1. Зайдите в репозиторий на Gitlab по адресу https://gitlab.com/dan-it/groups/fem7
2. Справа есть кнопка clone, нажмите ее и скопируйте ссылку, указанную под `clone with HTTPS`, в буфер обмена.
3. Откройте консоль в папке, _внутрь которой_ вы хотите поместить папку с репозиторием fem7. Т.е. например если вы хотите, чтобы структура папок была danit/fem7, откройте консоль в danit.
4. Выполните команду
   `git clone <ссылка на репозиторий>`
	 например
	 `git clone https://gitlab.com/dan-it/groups/fem7`
5. Если вы что-то клонируете с GitLab в первый раз, появится окно Windows Credentials, введите туда свой логин и пароль. Этот пароль и логин сохраняются в диспетчере учетных данных Windows, чтобы не приходилось вводить его заново каждый раз. Но с этим связана возможная проблема, если вы ввели их неправильно: см. [здесь](#Неправильно-введенный-логин-и-пароль)
6. Если все прошло успешно, у вас появится локальная папка fem7. Чтобы обновлять ее содержимое (например, posh-git будет показывать, если локальная версия отстает от версии на Gtlab) используте команду `git pull`. Например, после занятий, чтобы подтянуть себе изменения проекта, над которым вы совместно работали в классе.

## Создание своего репозитория и заливка его на GitLab (например, репозиторий с домашней работой)

Имеет смысл создать один репозиторий, который будет содержать все ваши домашние работы. если вы придерживаетесь структуры папок, показанной на примере выше, это будет папка homework.

1. Откройте консоль в папке homework (с помощью опции контекстного меню ConEmu here, например). или переместиесь туда с помощью команды `cd <путь к папке>`
2. Инициализируйте пустой репозиторий командой `git init`
3. Добавьте содержимое папки в индекс командой `git add .` (обратите внимание на точку в конце, это значит, что мы добавляем все файлы. без точки не сработает).
_Важно_: вы не сможете ничего добавить и залить на GitLab, если ваш репозиторий пуст. Поэтому если вы экспериментируете с пустой только что созданной папкой, добавьте туда какой-нибудь файл. Вы можете создать пустой файл с именем `.gitignore`
4. Если команда add прошла нормально и вы используете posh-git, в статусе posh-git добавленные изменения отобразятся зеленым цветом вместо красного. Также это можно проверить командой `git status`.
5. После этого изменения можно закоммитить. Выполните команду `git commit -m "initial commit"` (при последующих коммитах задавайте текст сообщения так, чтобы он описывал характер изменений, которые вы вносите этим коммитом).
6. Git выдаст сообщение об удачном коммите, статус posh-git сбросится (будет отображаться только имя текущей ветки, например [master]). После этого вы готовы пушить изменения на Gitlab.
7. Сначала надо создать репозиторий на Gitlab. Это делается по кнопке +new - New project. Задайте имя проекта, смените visibility на "public" (это нужно, чтобы ментор смог получить доступ к вашему репозиторию)/ __Внимание__: __НЕ__ ставьте птичку в чекбоксе initialize repository - это в дальнейшем приведет к ошибке, если вы собираетесь залить сюда свой локальный репозиторий.
8. После этого Gitlab выдаст вам страницу с подсказками по дальнейшим действиям. Нам нужен вариант "Push an existing folder" (кроме тех действий, которые мы уже сделали). Т.е. нам осталось в локальном репозитории выполнить команды:
`git remote add origin <ссылка на репозиторий Gitlab>` (скопируйте ссылку с GitLab)
9. И теперь можно делать `git push -u origin master`
Перед тем, как выполнять пуш, убедитесь, что ваш репозиторий "чист", т.е. вы закоммитили все изменения. Это видно в posh-git, или же вы можете выполнить команду `git status`, должно быть написано "working tree clean".
Иначе git не даст вам выполнить push.

10. Последующие push
Если при пуше вы указываете аргумент `-u` (как в нашем случае) это значит, что в дальнейшем вы сможете совершать пуш просто как `git push` (остальные аргументы сохранятся в конфигурации). Перед последующими пушами обычно желательно выполнять команду `git pull`, чтобы проверять изменения на сервере, хотя если вы единственный человек, кто работает над репозиторием, как в случае с репозиторием homework, изменений, очевидно не будет.
Когда вы работаете над проектом, хорошей привычкой является периодически коммитить изменения с помощью последовательности команд `git add` и `git commit`. Когда вы хотите залить изменения на GitLab, чтобы ментор смог их проверить - используйте `git push`.

### Возможные проблемы и их решения.

#### Неправильно введенный логин и пароль.
если вы неправильно ввели логин и пароль при авторизации через Windows Credential Manager, при клонировании консоль может выдавать ошибку типа HTTP Basic: Access denied, а поле ввода для пароля больше не будет появляться. В этом случае вам нужно будет сбросить логин и пароль в диспетчере учетных данных Windows, как это сделать, см. [здесь](https://dan-it.gitlab.io/fe-book/git/git_reset_password.html).
Если вы не на Windows, в некоторых случаях может помочь команда `git config --global --unset credential.helper` см. [здесь](https://stackoverflow.com/questions/15381198/remove-credentials-from-git).

#### Репозиторий пуст.
Если вы получаете ошибку
"error: src refspec master does not match any
error: failed to push some refs to..."
Вероятно вы пытаетесь запушить пустой репозиторий, в котором еще нет ни одного коммита. Убедитесь, что ваш коммит прошел успешно, а чтобы это быо так - что ваша папка (рабочая директория) соержит какие-то файлы, см.выше в пункте 3.

#### Вы проинициализировали репозиторий на GitLab при его создании.
При попытке push вы получаете ошибку
"! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'https://gitlab.com/...'
hint: Updates were rejected because the remote contains work that you do"
Проблема в том, что вы проинициализировали репозиторий на GitLab при его создании.Вообще это лечится при помощи аргумента `--force`, т.е. `git push -u origin master --force`, но при попытке выполнить эту кманду м получим другую ошибку: "remote: GitLab: You are not allowed to force push code to a protected branch on this".
Дело в том, что GitLab по умолчанию делает ветку master защищенной (protected) т.е. запрещает делать force-push в нее.
Нам нужно зайти в настройки репозитория на GitLab (они слева внизу: settings - repository - protected branches (нажать expand напротив этого пункта)) и нажать кнопку "unprotect".
После этого выполняем `git push -u origin master --force`

### Разное.
Что, если вы хотите "привязать" свой локальный репозиторий к другому репозиторию на GitLab, а старый удалить (так можно сделать при проблеме, описанной выше)?

#### Чтобы убрать привязку к репозиторию GitLab
Выполните `git remote remove origin`

#### Чтобы удалить репозиторий на GitLab:
Зайдите в настройки репозитория на GitLab (settings - general - advanced - expand)
В самом низу будет красная кнопка `delete project`. нажмите ее.
GitLab потребует ввести имя репозитория для подтверждения, сделайте это.

#### Настройка SSH на GitLab
настройка ключей SSH для работы с Gitlab необязательна, можно авторизироваться на ресурсе с помощью логина и пароля через Windows Credential Manager. Но при желании вы можете настроить SSH.

##### Windows
1. Включение Open-SSH.
В Windows 10 существует встроенный клиент SSH (Open-SHH), но его нужно включить.
делается это через Параметры - Приложения и возможности - Дополнительные возможости (над списком приложений) - откроется список "фич", вам нужно поставить птичку возле Open-SSH. https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement

2. Генерация ключей.
Ключи SSH обычно принять хранить в папке .ssh в папке вашего профиля.
Т.о., чтобы сгенерировать ключи, откройте Powershell в этой папке
(можно переместиться  туда командой `cd $HOME\.ssh\`).
В этой папке выполняем `ssh-keygen -t ed25519`  (ed25519 это рекомендуемый тип шифрования, альтернативнй вариант - rsa) и получаем два файла в этой папке, приватный и публичный ключ (будет иметь расширение .pub)

3. Теперь приватный ключ нужно добавить в ssh-agent, сервис, который должен бть запущен на ввашем компьютере и будет обеспечивать авторизацию с помощью этого ключа.
По умолчанию способ запуска этого сервиса в последних версиях Windows установлен в disabled, поэтому сначала выполните команды в Powershell таком порядке: `Set-Service -Name ssh-agent -StartupType Manual` .
`Start-Service ssh-agent`
`ssh-add $HOME\.ssh\id_ed25519` (убедитесь, что правильно указали имя файла).
После этого можете сохранить приватный ключ в каком-то безопасном месте и удалить его из папки .ssh

4. Теперь нужно указать публичный ключ на сервере (например, GitLab).
- копируем ключ в буфер обмена: `cat $HOME/.ssh/id_ed25519.pub | clip`
- Открываем на Gitlab страницу опций user settings - SSH Keys https://gitlab.com/profile/keys и вставляем в нужное поле ключ через Ctrl-V.

5. Проверяем, что все работает: `ssh -T git@gitlab.com`
